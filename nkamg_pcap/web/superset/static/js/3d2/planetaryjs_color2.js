/*! Planetary.js v1.1.2
 *  Copyright (c) 2013 Michelle Tilley
 *
 *  Released under the MIT license
 *  Date: 2015-11-22T10:07:37.594Z
 */
(function(a,b){if(typeof define==="function"&&define.amd){define(["d3","topojson"],function(d,c){return(a.planetaryjs=b(d,c,a))})}else{if(typeof exports==="object"){module.exports=b(require("d3"),require("topojson"))}else{a.planetaryjs=b(a.d3,a.topojson,a)}}}(this,function(j,a,f){var c=null;if(f){c=f.planetaryjs}var d=[];var b=function(l,m,k){j.timer(function(){if(l.stopped){return true}l.context.clearRect(0,0,m.width,m.height);for(var n=0;n<k.onDraw.length;n++){k.onDraw[n]()}})};var e=function(k,m){for(var l=d.length-1;l>=0;l--){m.unshift(d[l])}if(m.length===0){if(h.plugins.earth){k.loadPlugin(h.plugins.earth())}if(h.plugins.pings){k.loadPlugin(h.plugins.pings())}}for(l=0;l<m.length;l++){m[l](k)}};var i=function(m,n,k){if(k.onInit.length){var o=0;var p=function(r){var q=k.onInit[o];if(q.length){q(function(){o++;r()})}else{q();o++;setTimeout(r,0)}};var l=function(){if(o>=k.onInit.length){b(m,n,k)}else{p(l)}};p(l)}else{b(m,n,k)}};var g=function(l,m,n,k){l.canvas=m;l.context=m.getContext("2d");if(l.stopped!==true){e(l,n)}l.stopped=false;i(l,m,k)};var h={plugins:{},noConflict:function(){f.planetaryjs=c;return h},loadPlugin:function(k){d.push(k)},planet:function(){var m=[];var k={onInit:[],onDraw:[],onStop:[]};var l={plugins:{},draw:function(n){g(l,n,m,k)},onInit:function(n){k.onInit.push(n)},onDraw:function(n){k.onDraw.push(n)},onStop:function(n){k.onStop.push(n)},loadPlugin:function(n){m.push(n)},stop:function(){l.stopped=true;for(var n=0;n<k.onStop.length;n++){k.onStop[n](l)}},withSavedContext:function(n){if(!this.context){throw new Error("No canvas to fetch context for")}this.context.save();n(this.context);this.context.restore()}};l.projection=j.geo.orthographic().clipAngle(90);l.path=j.geo.path().projection(l.projection);return l}};h.plugins.topojson=function(k){return function(l){l.plugins.topojson={};l.onInit(function(m){if(k.world){l.plugins.topojson.world=k.world;setTimeout(m,0)}else{var n=k.file||"world-110m.json";console.log(k.file);console.log(n);j.json(n,function(o,p){if(o){throw new Error("Could not load JSON "+n)}l.plugins.topojson.world=p;m()})}})}};h.plugins.oceans=function(k){return function(l){l.onDraw(function(){l.withSavedContext(function(n){n.beginPath();var m=n.createRadialGradient(1000,320,0,1000,320,800);m.addColorStop(0.8,"#000b20");l.path.context(n)({type:"Sphere"});n.fillStyle=m;n.shadowBlur=k.shadowBlur;n.shadowColor=k.shadowColor;n.fill()})})}};h.plugins.land=function(k){return function(m){var l=null;m.onInit(function(){var n=m.plugins.topojson.world;l=a.feature(n,n.objects.land)});m.onDraw(function(){m.withSavedContext(function(n){n.beginPath();m.path.context(n)(l);if(k.fill!==false){n.fillStyle=k.fill||"white";n.shadowBlur=40;n.shadowColor="#888";n.fill()}if(k.stroke){if(k.lineWidth){n.lineWidth=k.lineWidth}n.strokeStyle=k.stroke;n.stroke()}})})}};h.plugins.borders=function(k){return function(l){var n=null;var m={internal:function(p,o){return p.id!==o.id},external:function(p,o){return p.id===o.id},both:function(p,o){return true}};l.onInit(function(){var q=l.plugins.topojson.world;var o=q.objects.countries;var p=k.type||"internal";n=a.mesh(q,o,m[p])});l.onDraw(function(){l.withSavedContext(function(o){o.beginPath();l.path.context(o)(n);o.strokeStyle=k.stroke||"gray";if(k.lineWidth){o.lineWidth=k.lineWidth}o.stroke()})})}};h.plugins.earth=function(m){m=m||{};var n=m.topojson||{};var l=m.oceans||{};var p=m.land||{};var k=m.borders||{};var o=m.graticule||{};return function(q){h.plugins.topojson(n)(q);h.plugins.oceans(l)(q);h.plugins.graticule(o)(q)}};h.plugins.pings=function(l){var o=[];l=l||{};var k=function(p){p=p||{};p.color=p.color||l.color||"white";p.angle=p.angle||l.angle||5;p.ttl=p.ttl||l.ttl||2000;var q={time:new Date(),options:p};if(l.latitudeFirst){q.lat=p.lat;q.lng=p.lng}else{q.lng=p.lng;q.lat=p.lat}o.push(q)};var m=function(p,s,q){var u=[];for(var r=0;r<o.length;r++){var v=o[r];var t=q-v.time;if(t<v.options.ttl){u.push(v);n(p,s,q,t,v)}}o=u};var n=function(u,q,r,w,x){var s=1-(w/x.options.ttl);var t=j.rgb(x.options.color);var v=x.options.lineWidth||5;t="rgba("+t.r+","+t.g+","+t.b+","+s+")";q.strokeStyle=t;q.lineWidth=v;var p=j.geo.circle().origin([x.lng,x.lat]).angle(w/x.options.ttl*x.options.angle)();q.beginPath();u.path.context(q)(p);q.stroke()};return function(p){p.plugins.pings={add:k};p.onDraw(function(){var q=new Date();p.withSavedContext(function(r){m(p,r,q)})})}};h.plugins.zoom=function(l){l=l||{};var p=function(){};var o=l.onZoomStart||p;var k=l.onZoomEnd||p;var n=l.onZoom||p;var r=l.afterZoom||p;var m=l.initialScale;var q=l.scaleExtent||[50,2000];return function(s){s.onInit(function(){var t=j.behavior.zoom().scaleExtent(q);if(m!==null&&m!==undefined){t.scale(m)}else{t.scale(s.projection.scale())}t.on("zoomstart",o.bind(s)).on("zoomend",k.bind(s)).on("zoom",function(){n.call(s);s.projection.scale(j.event.scale);r.call(s)});j.select(s.canvas).call(t)})}};h.plugins.drag=function(m){m=m||{};
var n=function(){};var p=m.onDragStart||n;var k=m.onDragEnd||n;var l=m.onDrag||n;var o=m.afterDrag||n;return function(q){q.onInit(function(){var r=j.behavior.drag().on("dragstart",p.bind(q)).on("dragend",k.bind(q)).on("drag",function(){l.call(q);var u=j.event.dx;var t=j.event.dy;var v=q.projection.rotate();var s=q.projection.scale();var y=j.scale.linear().domain([-1*s,s]).range([-90,90]);var x=y(u);var w=y(t);v[0]+=x;v[1]-=w;if(v[1]>90){v[1]=90}if(v[1]<-90){v[1]=-90}if(v[0]>=180){v[0]-=360}q.projection.rotate(v);o.call(q)});j.select(q.canvas).call(r)})}};h.plugins.lines=function(l){var k=[];l=l||{};var m=function(q){q=q||{};q.color=q.color||l.color||"red";q.angle=q.angle||l.angle||5;q.ttl=q.ttl||l.ttl||2000;q.lineWidth=q.lineWidth||1;var p={time:new Date(),options:q};q.lng0=(q.lng0+180)%360-180;q.lat0=(q.lat0+90)%180-90;q.lng1=(q.lng1+180)%360-180;q.lat1=(q.lat1+90)%180-90;p.lat0=q.lat0;p.lng0=q.lng0;p.lat1=q.lat1;p.lng1=q.lng1;k.push(p)};var o=function(r,u,s){var q=[];for(var t=0;t<k.length;t++){var p=k[t];var v=s-p.time;if(v<p.options.ttl){q.push(p);n(r,u,s,v,p)}}k=q};var n=function(F,u,r,q,D){var z=1-(q/D.options.ttl);var J=j.rgb(D.options.color);var q=r-D.time;var I=300;var w=D.options.ttl;var G=(D.lat1-D.lat0)/(D.options.ttl-I);var C=(D.lng1-D.lng0)/(D.options.ttl-I);var x={"lat":0,"lng":0};var B={"lat":0,"lng":0};var y=j.geo.interpolate([D.lng0,D.lat0],[D.lng1,D.lat1]);if(q<I){x.lat=D.lat0;x.lng=D.lng0}else{var E=1*(q-I)/(w-I);var M=y(E);x.lat=M[1];x.lng=M[0]}if((D.options.ttl-q)<I){B.lat=D.lat1;B.lng=D.lng1}else{var E=1*q/(w-I);var M=y(E);B.lat=M[1];B.lng=M[0]}var L={"type":"Feature","geometry":{"type":"LineString","coordinates":[[x.lng,x.lat],[B.lng,B.lat]]}};var p=F.projection([x.lng,x.lat]);var A=F.projection([B.lng,B.lat]);var H=u.createLinearGradient(A[0],A[1],p[0],A[1]);var K=j.rgb(D.options.color);var v="rgba( "+K.r+","+K.g+","+K.b+", "+1+")";var s="rgba( "+K.r+","+K.g+","+K.b+", "+0+")";H.addColorStop(0,v);H.addColorStop(1,s);u.save();u.strokeStyle=H;u.shadowColor=D.options.color;u.shadowBlur=5;u.lineJoin="round";u.lineCap="round";u.lineWidth=D.options.lineWidth;u.beginPath();F.path.context(u)(L);u.stroke();u.restore()};return function(p){p.plugins.lines={add:m};p.onDraw(function(){var q=new Date();p.withSavedContext(function(r){o(p,r,q)})})}};h.plugins.fixLines=function(l){var k=[];l=l||{};var m=function(q){q=q||{};q.color=q.color||l.color||"red";q.angle=q.angle||l.angle||5;q.ttl=q.ttl||l.ttl||2000;q.lineWidth=q.lineWidth||2;var p={time:new Date(),options:q};q.lng0=(q.lng0+180)%360-180;q.lat0=(q.lat0+90)%180-90;q.lng1=(q.lng1+180)%360-180;q.lat1=(q.lat1+90)%180-90;p.lat0=q.lat0;p.lng0=q.lng0;p.lat1=q.lat1;p.lng1=q.lng1;k.push(p)};var o=function(r,u,s){var q=[];for(var t=0;t<k.length;t++){var p=k[t];var v=s-p.time;if(v<p.options.ttl){q.push(p);n(r,u,s,v,p)}}k=q};var n=function(v,r,s,z,B){var t=1-(z/B.options.ttl);var u=j.rgb(B.options.color);var z=s-B.time;var w=400;var x=(B.lat1-B.lat0)/(B.options.ttl-w);var y=(B.lng1-B.lng0)/(B.options.ttl-w);var A={"lat":B.options.lat0,"lng":B.options.lng0};var q={"lat":B.options.lat1,"lng":B.options.lng1};var p={"type":"Feature","geometry":{"type":"LineString","coordinates":[[A.lng,A.lat],[q.lng,q.lat]]}};r.save();r.strokeStyle=B.options.color;r.shadowColor=B.options.color;r.shadowBlur=3;r.lineJoin="round";r.lineCap="round";r.lineWidth=B.options.lineWidth;r.lineWidth=1;r.setLineDash([2,15]);r.beginPath();v.path.context(r)(p);r.stroke();r.restore()};return function(p){p.plugins.fixLines={add:m};p.onDraw(function(){var q=new Date();p.withSavedContext(function(r){o(p,r,q)})})}};h.plugins.dots=function(k){var o=[];k=k||{};var l=function(q){q=q||{};q.color=q.color||k.color||"white";q.angle=q.angle||k.angle||5;q.ttl=q.ttl||k.ttl||2000;var p={time:new Date(),options:q};if(k.latitudeFirst){p.lat=q.lat;p.lng=q.lng}else{p.lng=q.lng;p.lat=q.lat}o.push(p)};var n=function(q,t,r){var v=[];for(var s=0;s<o.length;s++){var p=o[s];var u=r-p.time;if(u<p.options.ttl){v.push(p);m(q,t,r,u,p)}}o=v};var m=function(x,s,t,z,r){var v=r.options.alpha||0.5;var w=j.rgb(r.options.color);var u=r.options.angle||1;var y=0;w="rgba("+w.r+","+w.g+","+w.b+","+v+")";s.strokeStyle=w;s.lineWidth=y;var q={"type":"Feature","geometry":{"type":"Point","coordinates":[r.lng,r.lat]}};s.beginPath();var p=j.geo.circle().origin([r.lng,r.lat]).angle(u)();x.path.context(s)(p);s.fillStyle=w;s.stroke();s.fill()};return function(p){p.plugins.dots={add:l};p.onDraw(function(){var q=new Date();p.withSavedContext(function(r){n(p,r,q)})})}};h.plugins.graticule=function(k){var l=true;function m(n){l=n}return function(n){var o=null;n.plugins.graticule={"changeGraticule":m};n.onInit(function(){o=j.geo.graticule().extent([[-180,-90],[180,90]]).step([10,10])()});n.onDraw(function(){if(l){n.withSavedContext(function(p){p.beginPath();n.path.context(p)(o);p.strokeStyle=k.stroke||"gray";p.lineWidth=k.lineWidth||1;p.stroke()})}})}};h.plugins.myWorld=function(m){var s=null;var r="#226622";var n=[];var u=0;var q=0;var v=0;var l=0;
var k=-1;var p=0;var o=function(A){var z=parseInt(A.substr(1,2),16)-q;var y=parseInt(A.substr(3,2),16)-v;var x=parseInt(A.substr(5,2),16)-l;var w=z+y+x;if(w<p&&w>-1){k=w}else{k=-1}return k};var t=function(w){if(w==-1){return{}}else{return n[w]}};return function(x){var w=null;x.onInit(function(y){j.json("../../static/json/world2.geo.json",function(G,C){s=C;var K=C.features;p=K.length;u=parseInt(p/2);q=parseInt(r.substr(1,2),16);v=parseInt(r.substr(3,2),16);l=parseInt(r.substr(5,2),16);for(var D=0;D<p;++D){var A=parseInt(D/3);var H=parseInt(D-A*2);var B=q+A;var I=v+H;var z=l+A;var L=B.toString(16);if(1==L.length){L="0"+L}var E=I.toString(16);if(1==L.length){E="0"+E}var F=z.toString(16);if(1==F.length){F="0"+F}var J="#"+L+E+F;n.push({"id":K[D].id,"name":K[D].properties.name,"color":J})}y()})});x.onDraw(function(){x.withSavedContext(function(z){for(var y=0;y<s.features.length;++y){z.beginPath();x.path.context(z)(s.features[y]);if(m.fill!==false){if(y==k){z.fillStyle="green";z.fill()}else{z.fillStyle=n[y].color;z.fill()}}if(m.stroke){if(m.lineWidth){z.lineWidth=1}if(y==k){z.lineWidth=1;z.strokeStyle="#fff"}else{z.lineWidth=1;z.strokeStyle=m.stroke}z.stroke()}}if(k!=-1){z.closePath();z.beginPath();x.path.context(z)(s.features[k]);z.lineWidth=2;z.strokeStyle="#fff";z.stroke()}})});x.plugins.myWorld={"curIndex":o,"getCountryInfo":t}}};h.plugins.myWorld2=function(m){var s=null;var r="#990000";var n=[];var u=0;var q=0;var v=0;var l=0;var k=-1;var p=0;var o=function(A){var z=parseInt(A.substr(1,2),16)-q;var y=parseInt(A.substr(3,2),16)-v;var x=parseInt(A.substr(5,2),16)-l;var w=z+y+x;if(w<p&&w>-1){k=w}else{k=-1}return k};var t=function(w){if(w==-1){return{}}else{return n[w]}};return function(x){var w=null;x.onInit(function(y){j.json("../../static/json/world2.geo.json",function(G,C){s=C;var K=C.features;p=K.length;u=parseInt(p/2);q=parseInt(r.substr(1,2),16);v=parseInt(r.substr(3,2),16);l=parseInt(r.substr(5,2),16);for(var D=0;D<p;++D){var A=parseInt(D/3);var H=parseInt(D-A*2);var B=q+A;var I=v+H;var z=l+A;var L=B.toString(16);if(1==L.length){L="0"+L}var E=I.toString(16);if(1==L.length){E="0"+E}var F=z.toString(16);if(1==F.length){F="0"+F}var J="#"+L+E+F;n.push({"id":K[D].id,"name":K[D].properties.name,"color":m.fill||"#3f3f3f"})}y()})});x.onDraw(function(){x.withSavedContext(function(z){for(var y=0;y<s.features.length;++y){z.beginPath();x.path.context(z)(s.features[y]);if(m.fill!==false){if(y==k){z.fillStyle="green";z.fill()}else{z.fillStyle=n[y].color;z.fill()}}if(m.stroke){if(m.lineWidth){z.lineWidth=1}if(y==k){z.lineWidth=1;z.strokeStyle="#fff"}else{z.lineWidth=1;z.strokeStyle=m.stroke}z.stroke()}}if(k!=-1){z.closePath();z.beginPath();x.path.context(z)(s.features[k]);z.lineWidth=2;z.strokeStyle="#fff";z.stroke()}})});x.plugins.myWorld={"curIndex":o,"getCountryInfo":t}}};return h}));
